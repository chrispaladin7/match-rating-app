<%- include('../partials/header') %>

    <h1>
        <%= title %>
    </h1>

    <table id="list">
        <thead>
            <tr>
                <th>Match</th>
                <th>Home Name</th>
                <th>Away Name</th>
                <th>Score</th>
                <th>Date</th>
                <th>Time</th>
                <th>Stadium</th>
                <th>Competition</th>
            </tr>
        </thead>
        <tbody>
            <td>
                <%= matches.matchTitle %>
            </td>
            <td>
                <%= matches.homeTeam.name %> (<%= matches.homeTeam.abbreviation %>)
            </td>
            <td>
                <%= matches.awayTeam.name %> (<%= matches.awayTeam.abbreviation %>)
            </td>
            <td>
                <%= matches.homeScore %> - <%= matches.awayScore %>
            </td>
            <td>
                <%= matches.date.toLocaleDateString() %>
            </td>
            <td>
                <%= matches.date.toLocaleTimeString() %>
            </td>
            <td>
                <%= matches.stadium %>
            </td>
            <td>
                <%= matches.competition %>
            </td>
        </tbody>
    </table>

    <table id="list">
        <thead>
            <tr>
                <th>Home Starters</th>
                <th>Away Starters</th>
                <th>Home Substitutes</th>
                <th>Away Substitutes</th>
            </tr>
        </thead>
        <tbody>
            <td>
                <ul>
                    <%- matches.homeStarters.map(p=>
                        `<li>${p.position} : ${p.playerNum} ${p.playerName}</li>`
                        ).sort().join('') %>
                </ul>
            </td>
            <td>
                <ul>
                    <%- matches.awayStarters.map(a=>
                        `<li>${a.position} : ${a.playerNum} ${a.playerName}</li>`
                        ).sort().join('') %>
                </ul>
            </td>
            <td>
                <ul>
                    <%- matches.homeSubs.map(p=>
                        `<li>${p.position} : ${p.playerNum} ${p.playerName}</li>`
                        ).sort().join('') %>
                </ul>
            </td>
            <td>
                <ul>
                    <%- matches.awaySubs.map(a=>
                        `<li>${a.position} : ${a.playerNum} ${a.playerName}</li>`
                        ).sort().join('') %>
                </ul>
            </td>
        </tbody>
    </table>

    <section>
        <h2>Include your take on the Match below</h2>
        <form id="add-review-form" method="POST" action="/matches/<%= matches._id %>/reviews">
            <label>Review:</label>
            <textarea class="review-textarea" name="content"></textarea>
            <input type="submit" value="Add Review">
        </form>
    </section>

    <% if (matches.reviews.length) { %>
        <table>
            <thead>
                <tr>
                    <th>User</th>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Review</th>
                </tr>
            </thead>
            <tbody>
                <% matches.reviews.forEach(function(r) { %>
                    <tr>
                        <td class="review-user"><img alt="avatar" src="<%= r.userAvatar %>"
                                referrerpolicy="no-referrer">
                            <%= r.userName %>
                        </td>
                        <td>
                            <%= r.createdAt.toLocaleDateString() %>
                        </td>
                        <td>
                            <%= r.createdAt.toLocaleTimeString() %>
                        </td>
                        <td>
                            <textarea class="review-textarea-update" name="textarea" cols="15" rows="5" disabled="true">
                            <%= r.content %>
                            </textarea>
                        </td>
                        <td>
                            <% if (user?._id.equals(r.user)) { %>
                                <form action="/reviews/<%= r._id %>?_method=DELETE" method="POST">
                                    <button type="submit">X</button>
                                </form>
                                <button class="toggle-button">Toggle Textarea</button>
                                <input  type="submit" value="UPDATE" class="update-review-button">
                                <% } %>
                        </td>
                    </tr>
                    <% }); %>
            </tbody>
        </table>
        <% } else { %>
            <h5>No Reviews Yet</h5>
            <% } %>

            <script>
                // Get references to the button and textareas
                const toggleButton = document.querySelector('.toggle-button');
                const reviewTextarea = document.querySelector('.review-textarea-update');
                const updateButton = document.querySelector('.update-review-button');
            
                // Initialize the updateButton to be hidden
                updateButton.style.visibility = 'hidden';
            
                // Add a click event listener to the button
                toggleButton.addEventListener('click', () => {
                    // Toggle the disabled attribute of the reviewTextarea
                    reviewTextarea.disabled = !reviewTextarea.disabled;
            
                    // Toggle the visibility of the updateButton
                    updateButton.style.visibility = reviewTextarea.disabled ? 'hidden' : 'visible';
                });
            </script>
            


                <%- include('../partials/footer') %>